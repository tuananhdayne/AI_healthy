<div class="settings-root">
  <aside class="settings-nav">
    <div class="nav-header">
      <div class="header-icon">‚öïÔ∏è</div>
      <div class="header-text">
        <h2>C√†i ƒê·∫∑t</h2>
        <p class="header-subtitle">Qu·∫£n l√Ω t√†i kho·∫£n</p>
      </div>
    </div>
    <ul>
      <li *ngFor="let item of navItems" (click)="setActive(item)" [class.active]="active === item">
        <span class="icon">{{ getNavIcon(item) }}</span>
        <span class="label">{{ item }}</span>
      </li>
    </ul>
  </aside>

  <section class="settings-panel">
    <header class="panel-header">
      <div class="header-content">
        <h3>{{ active }}</h3>
        <p class="header-description">{{ getHeaderDescription(active) }}</p>
      </div>
    </header>

    <div class="panel-body">
      <form [formGroup]="settingsForm" (ngSubmit)="save()">
        <div *ngIf="active === 'Chung'">
          <div class="settings-card">
            <div class="card-header">
              <span class="card-icon">üé®</span>
              <label class="card-title">Giao di·ªán</label>
            </div>
            <div class="radios-group">
              <label class="radio-option">
                <input type="radio" formControlName="theme" value="light" />
                <span class="radio-label">
                  <span class="radio-icon">‚òÄÔ∏è</span>
                  <span class="radio-text">
                    <strong>S√°ng</strong>
                    <small>Giao di·ªán s√°ng, d·ªÖ nh√¨n</small>
                  </span>
                </span>
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="theme" value="dark" />
                <span class="radio-label">
                  <span class="radio-icon">üåô</span>
                  <span class="radio-text">
                    <strong>T·ªëi</strong>
                    <small>Giao di·ªán t·ªëi, b·∫£o v·ªá m·∫Øt</small>
                  </span>
                </span>
              </label>
            </div>
          </div>

          <div class="settings-card">
            <div class="card-header">
              <span class="card-icon">üåê</span>
              <label class="card-title">Ng√¥n ng·ªØ</label>
            </div>
            <div class="form-field">
              <select class="modern-select" formControlName="language">
                <option value="auto">D√≤ t√¨m t·ª± ƒë·ªông</option>
                <option value="vi">Ti·∫øng Vi·ªát</option>
                <option value="en">English</option>
              </select>
              <p class="help-text">Ng√¥n ng·ªØ hi·ªÉn th·ªã c·ªßa giao di·ªán</p>
            </div>
          </div>
        </div>

        <div *ngIf="active === 'Th√¥ng b√°o'">
          <div class="settings-card">
            <div class="card-header">
              <span class="card-icon">üìß</span>
              <label class="card-title">Email th√¥ng b√°o</label>
            </div>
            <label class="switch-option">
              <input 
                type="checkbox" 
                [checked]="settingsForm.value.notifications" 
                (change)="onNotificationChange($event)"
              />
              <span class="switch-slider"></span>
              <span class="switch-label">
                <strong>Nh·∫≠n email th√¥ng b√°o</strong>
                <small>Nh·∫≠n th√¥ng b√°o qua email v·ªÅ c√°c c·∫≠p nh·∫≠t quan tr·ªçng</small>
              </span>
            </label>
          </div>

          <div class="settings-card">
            <div class="card-header">
              <span class="card-icon">üîî</span>
              <label class="card-title">Th√¥ng b√°o tr√¨nh duy·ªát</label>
            </div>
            <label class="switch-option">
              <input 
                type="checkbox" 
                formControlName="pushNotifications"
                (change)="onPushNotificationChange($event)"
              />
              <span class="switch-slider"></span>
              <span class="switch-label">
                <strong>B·∫≠t th√¥ng b√°o nh·∫Øc nh·ªü</strong>
                <small>Nh·∫≠n th√¥ng b√°o nh·∫Øc nh·ªü u·ªëng thu·ªëc tr√™n tr√¨nh duy·ªát</small>
              </span>
            </label>
          </div>
        </div>

        <div *ngIf="active === 'T√†i kho·∫£n'">
          <!-- Th√¥ng tin ng∆∞·ªùi d√πng -->
          <div class="settings-card">
            <div class="card-header">
              <span class="card-icon">üë§</span>
              <label class="card-title">Th√¥ng tin c√° nh√¢n</label>
            </div>
            <form [formGroup]="userInfoForm" (ngSubmit)="saveUserInfo()">
              <div class="form-field">
                <label class="field-label">
                  H·ªç v√† t√™n <span class="required">*</span>
                </label>
                <input 
                  type="text" 
                  formControlName="fullName" 
                  placeholder="Nh·∫≠p h·ªç v√† t√™n"
                  class="modern-input"
                  [disabled]="!currentUser?.username"
                />
                <p class="field-help" *ngIf="!currentUser?.username">
                  <span class="help-icon">‚ÑπÔ∏è</span>
                  T√†i kho·∫£n Google kh√¥ng th·ªÉ ch·ªânh s·ª≠a th√¥ng tin t·∫°i ƒë√¢y
                </p>
              </div>
              <div class="form-field">
                <label class="field-label">
                  Email <span class="required">*</span>
                </label>
                <input 
                  type="email" 
                  formControlName="email" 
                  placeholder="Nh·∫≠p email"
                  class="modern-input"
                  [disabled]="!currentUser?.username"
                />
              </div>
              <div class="form-field">
                <label class="field-label">S·ªë ƒëi·ªán tho·∫°i</label>
                <input 
                  type="tel" 
                  formControlName="phone" 
                  placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i (10-11 s·ªë)"
                  class="modern-input"
                  [disabled]="!currentUser?.username"
                />
              </div>
              <div class="form-actions" *ngIf="currentUser?.username">
                <button 
                  type="submit" 
                  class="btn-primary-medical" 
                  [disabled]="userInfoForm.invalid || isLoadingUserInfo"
                >
                  <span *ngIf="!isLoadingUserInfo">üíæ L∆∞u th√¥ng tin</span>
                  <span *ngIf="isLoadingUserInfo">‚è≥ ƒêang l∆∞u...</span>
                </button>
              </div>
              <div class="message-success" *ngIf="userInfoMessage">
                <span class="message-icon">‚úÖ</span>
                {{ userInfoMessage }}
              </div>
              <div class="message-error" *ngIf="userInfoError">
                <span class="message-icon">‚ö†Ô∏è</span>
                {{ userInfoError }}
              </div>
            </form>
          </div>

          <!-- M√£ PIN -->
          <div class="settings-card" *ngIf="currentUser?.username">
            <div class="card-header">
              <span class="card-icon">üîê</span>
              <label class="card-title">M√£ PIN b·∫£o m·∫≠t</label>
            </div>
            <form [formGroup]="pinForm" (ngSubmit)="savePin()">
              <div class="form-field">
                <label class="field-label">
                  M√£ PIN hi·ªán t·∫°i <span class="required">*</span>
                </label>
                <input 
                  type="text" 
                  formControlName="currentPin" 
                  placeholder="Nh·∫≠p m√£ PIN hi·ªán t·∫°i (6 ch·ªØ s·ªë)"
                  class="modern-input pin-input"
                  maxlength="6"
                  (keypress)="onPinCodeKeyPress($event)"
                  (input)="onPinInput($event)"
                />
                <span class="error-message" *ngIf="pinForm.get('currentPin')?.invalid && pinForm.get('currentPin')?.touched">
                  Vui l√≤ng nh·∫≠p m√£ PIN hi·ªán t·∫°i (6 ch·ªØ s·ªë)
                </span>
              </div>
              <div class="form-field">
                <label class="field-label">
                  M√£ PIN m·ªõi <span class="required">*</span>
                </label>
                <input 
                  type="text" 
                  formControlName="newPin" 
                  placeholder="Nh·∫≠p m√£ PIN m·ªõi (6 ch·ªØ s·ªë)"
                  class="modern-input pin-input"
                  maxlength="6"
                  (keypress)="onPinCodeKeyPress($event)"
                  (input)="onPinInput($event)"
                />
                <span class="error-message" *ngIf="pinForm.get('newPin')?.invalid && pinForm.get('newPin')?.touched">
                  Vui l√≤ng nh·∫≠p m√£ PIN m·ªõi (6 ch·ªØ s·ªë)
                </span>
              </div>
              <div class="form-field">
                <label class="field-label">
                  X√°c nh·∫≠n m√£ PIN m·ªõi <span class="required">*</span>
                </label>
                <input 
                  type="text" 
                  formControlName="confirmPin" 
                  placeholder="Nh·∫≠p l·∫°i m√£ PIN m·ªõi (6 ch·ªØ s·ªë)"
                  class="modern-input pin-input"
                  maxlength="6"
                  (keypress)="onPinCodeKeyPress($event)"
                  (input)="onPinInput($event)"
                />
                <span class="error-message" *ngIf="pinForm.get('confirmPin')?.invalid && pinForm.get('confirmPin')?.touched">
                  Vui l√≤ng x√°c nh·∫≠n m√£ PIN m·ªõi
                </span>
                <span class="error-message" *ngIf="pinForm.errors?.['pinMismatch'] && pinForm.get('confirmPin')?.touched">
                  ‚ö†Ô∏è M√£ PIN x√°c nh·∫≠n kh√¥ng kh·ªõp
                </span>
              </div>
              <div class="form-actions">
                <button 
                  type="submit" 
                  class="btn-primary-medical" 
                  [disabled]="pinForm.invalid || isLoadingPin"
                >
                  <span *ngIf="!isLoadingPin">üîí C·∫≠p nh·∫≠t m√£ PIN</span>
                  <span *ngIf="isLoadingPin">‚è≥ ƒêang l∆∞u...</span>
                </button>
              </div>
              <div class="message-success" *ngIf="pinMessage">
                <span class="message-icon">‚úÖ</span>
                {{ pinMessage }}
              </div>
              <div class="message-error" *ngIf="pinError">
                <span class="message-icon">‚ö†Ô∏è</span>
                {{ pinError }}
              </div>
            </form>
          </div>
          <div class="settings-card info-card" *ngIf="!currentUser?.username">
            <div class="info-content">
              <span class="info-icon">‚ÑπÔ∏è</span>
              <p>T√†i kho·∫£n Google kh√¥ng c√≥ m√£ PIN</p>
            </div>
          </div>

          <!-- H√†nh ƒë·ªông -->
          <div class="settings-card">
            <div class="card-header">
              <span class="card-icon">‚öôÔ∏è</span>
              <label class="card-title">H√†nh ƒë·ªông</label>
            </div>
            <div class="action-buttons">
              <button 
                type="button" 
                class="action-btn btn-change-password" 
                (click)="goToChangePassword()"
                *ngIf="currentUser?.username"
              >
                <span class="btn-icon">üîë</span>
                <span class="btn-text">
                  <strong>ƒê·ªïi M·∫≠t Kh·∫©u</strong>
                  <small>Thay ƒë·ªïi m·∫≠t kh·∫©u t√†i kho·∫£n</small>
                </span>
              </button>
              <button type="button" class="action-btn btn-reset" (click)="reset()">
                <span class="btn-icon">üîÑ</span>
                <span class="btn-text">
                  <strong>ƒê·∫∑t l·∫°i c√†i ƒë·∫∑t</strong>
                  <small>Kh√¥i ph·ª•c c√†i ƒë·∫∑t m·∫∑c ƒë·ªãnh</small>
                </span>
              </button>
              <button type="button" class="action-btn btn-logout" (click)="logout()">
                <span class="btn-icon">üö™</span>
                <span class="btn-text">
                  <strong>ƒêƒÉng xu·∫•t</strong>
                  <small>Tho√°t kh·ªèi t√†i kho·∫£n</small>
                </span>
              </button>
            </div>
          </div>
        </div>

        <div class="actions-footer" *ngIf="active !== 'T√†i kho·∫£n'">
          <button type="submit" class="btn-primary-medical">
            <span class="btn-icon">üíæ</span>
            L∆∞u c√†i ƒë·∫∑t
          </button>
          <button type="button" class="btn-secondary-medical" (click)="reset()">
            <span class="btn-icon">‚Ü∫</span>
            Kh√¥i ph·ª•c m·∫∑c ƒë·ªãnh
          </button>
        </div>
      </form>
    </div>
  </section>
</div>
